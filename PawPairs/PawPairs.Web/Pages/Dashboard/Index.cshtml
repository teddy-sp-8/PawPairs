@page
@model PawPairs.Web.Pages.Dashboard.IndexModel
@using PawPairs.Domain.Enums
@{
    ViewData["Title"] = "My Dashboard";
}

<div class="page-hero mb-4 d-flex align-items-center justify-content-between">
    <div>
        <h2 class="mb-1">✨ My Dashboard</h2>
        <div class="small-muted">My pets · pending requests · match history</div>
    </div>
    <span class="badge badge-soft">Logged in</span>
</div>

@if (TempData["Error"] is not null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

@if (Model.MyPets.Count == 0)
{
    <div class="alert alert-info">
        You don’t have any pets yet. Add one first 🐾
        <div class="mt-2">
            <a class="btn btn-primary" asp-page="/Pets/Create">➕ Add Pet</a>
        </div>
    </div>
}
else
{
    <div class="row g-3 mb-4">
        @foreach (var p in Model.MyPets)
        {
            <div class="col-md-4">
                <div class="card h-100 pet-card">
                    <div class="card-body">
                        <div class="pet-name">@p.Name</div>
                        <div class="pet-sub">@p.Species · @p.BreedName</div>
                        <div class="pet-meta mt-3">
                            <div><span class="muted">Energy:</span> <b>@p.EnergyLevel</b></div>
                            <div><span class="muted">Vaccinated:</span> <b>@(p.IsVaccinated ? "Yes ✅" : "No ❌")</b></div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent d-flex gap-2">
                        <a class="btn btn-sm btn-outline-dark" asp-page="/Pets/Details" asp-route-id="@p.Id">Details</a>
                        <a class="btn btn-sm btn-outline-secondary" asp-page="/Pets/Edit" asp-route-id="@p.Id">Edit</a>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="row g-4">
        <!-- Pending incoming -->
        <div class="col-lg-6">
            <div class="kawaii-card">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <div>
                        <div class="pet-name">📩 Pending (Incoming)</div>
                        <div class="small-muted">Requests sent to your pets</div>
                    </div>
                    <span class="badge badge-soft">@Model.PendingIncoming.Count</span>
                </div>

                @if (Model.PendingIncoming.Count == 0)
                {
                    <div class="alert alert-info mb-0">No incoming pending requests.</div>
                }
                else
                {
                    <div class="d-grid gap-2">
                        @foreach (var r in Model.PendingIncoming.Take(8))
                        {
                            <div class="card p-3 breed-click">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <div class="fw-semibold">
                                            @r.FromPetName <span class="text-muted">→</span> @r.ToPetName
                                        </div>
                                        <div class="small text-muted">
                                            @r.CreatedAtUtc.ToLocalTime()
                                        </div>
                                    </div>
                                    <span class="badge bg-warning text-dark">Pending</span>
                                </div>

                                <div class="d-flex gap-2 mt-3">
                                    <form method="post" asp-page-handler="Accept" asp-route-id="@r.Id" class="w-50">
                                        <button class="btn btn-success w-100">Accept ✅</button>
                                    </form>
                                    <form method="post" asp-page-handler="Reject" asp-route-id="@r.Id" class="w-50">
                                        <button class="btn btn-outline-danger w-100">Reject ✖</button>
                                    </form>
                                </div>
                            </div>
                        }
                    </div>

                    @if (Model.PendingIncoming.Count > 8)
                    {
                        <div class="text-center text-muted small mt-3">
                            Showing first 8. (You can add a “View all” later)
                        </div>
                    }
                }
            </div>
        </div>

        <!-- Pending outgoing -->
        <div class="col-lg-6">
            <div class="kawaii-card">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <div>
                        <div class="pet-name">📤 Pending (Outgoing)</div>
                        <div class="small-muted">Requests your pets sent</div>
                    </div>
                    <span class="badge badge-soft">@Model.PendingOutgoing.Count</span>
                </div>

                @if (Model.PendingOutgoing.Count == 0)
                {
                    <div class="alert alert-info mb-0">No outgoing pending requests.</div>
                }
                else
                {
                    <div class="d-grid gap-2">
                        @foreach (var r in Model.PendingOutgoing.Take(8))
                        {
                            <div class="card p-3">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <div class="fw-semibold">
                                            @r.FromPetName <span class="text-muted">→</span> @r.ToPetName
                                        </div>
                                        <div class="small text-muted">
                                            @r.CreatedAtUtc.ToLocalTime()
                                        </div>
                                    </div>
                                    <span class="badge bg-warning text-dark">Pending</span>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- Match history -->
        <div class="col-12">
            <div class="kawaii-card">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <div>
                        <div class="pet-name">🗂 Match History</div>
                        <div class="small-muted">Accepted & rejected requests</div>
                    </div>
                    <span class="badge badge-soft">@Model.History.Count</span>
                </div>

                @if (Model.History.Count == 0)
                {
                    <div class="alert alert-info mb-0">No history yet.</div>
                }
                else
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Status</th>
                                    <th>When</th>
                                </tr>
                            </thead>
                            <tbody>
                            @foreach (var r in Model.History.Take(20))
                            {
                                <tr>
                                    <td class="fw-semibold">@r.FromPetName</td>
                                    <td class="fw-semibold">@r.ToPetName</td>
                                    <td>
                                        @if (r.Status == MatchStatus.Accepted)
                                        {
                                            <span class="badge bg-success">Accepted</span>
                                        }
                                        else if (r.Status == MatchStatus.Rejected)
                                        {
                                            <span class="badge bg-danger">Rejected</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">@r.Status</span>
                                        }
                                    </td>
                                    <td class="text-muted">@r.CreatedAtUtc.ToLocalTime()</td>
                                </tr>
                            }
                            </tbody>
                        </table>
                    </div>

                    @if (Model.History.Count > 20)
                    {
                        <div class="text-center text-muted small mt-3">
                            Showing first 20.
                        </div>
                    }
                }
            </div>
        </div>
    </div>
}

<style>
    .breed-click { transition: transform .12s ease, box-shadow .12s ease; }
    .breed-click:hover { transform: translateY(-2px); box-shadow: 0 12px 28px rgba(0,0,0,.10); }
</style>
